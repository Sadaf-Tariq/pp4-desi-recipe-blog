{% extends 'base.html' %} 
{% block content %} 
{% load static %}
{% load crispy_forms_tags %}

<div id="recipe-detail" class="col-md-6">
  <div class="recipe-header-container">
    <div class="recipe-detail-header">
      <div class="recipe-detail-img">
        {% if "placeholder" in recipe.featured_image.url %}
        <img
          src="https://res.cloudinary.com/djo7pphyn/image/upload/v1698436271/ujp4et9qmtsvztyj0png.jpg"
          class="scale"
          alt="placeholder"
        />
        {% else %}
        <img
          src="{{ recipe.featured_image.url }}"
          class="scale"
          alt="{{ recipe.title }}"
        />
        {% endif %}
      </div>
      <div class="recipe-title">
        <h1 class="fontM logo-text text-color mb-4 pt-4 mt-2">
          {{ recipe.title }}
        </h1>
        <p class="fontH text-color">
          This recipe is published by
          <strong> "{{ recipe.author_name }}" </strong>
        </p>
        <p class="fontM text-color font-size">
          <strong
            >Rating: {{ recipe.average_rating }}/5.0
            <i class="far fa-star"></i> | Likes: {{ recipe.number_of_likes }}
            <i class="far fa-heart"></i> | 
            Comments: {{ recipe.number_of_comments}} <i class="fa-regular fa-comment"></i>
          </strong>
        </p>
      </div>
    </div>
  </div>
  

<div class="container all_details">
    <div class="row">
        <div class="recipe-info col-12 col-lg-6 text-center align-self-start">
                <p class="fontH">
                    <strong><i class="fa-solid fa-user-clock"></i>
                        Prep Time: {{ recipe.prep_time }} min -
                        <i class="fa-solid fa-clock"></i>
                        Cook Time: {{ recipe.cooking_time }} min
                    </strong>
                </p>
                <p class="fontH">
                    <strong><i class="fa-solid fa-spoon"></i> Method: {{ recipe.method }}</strong>
                </p>
                <p class="fontH">
                    <strong><i class="fa-solid fa-bowl-food"></i> Category: {{recipe.category }}</strong>
                </p>
                <p class="fontH">
                    <strong><i class="fa-solid fa-utensils"></i> Servings: {{ recipe.servings }}</strong>
                </p>
                <p class="fontH">
                    <strong><i class="fa-solid fa-weight-scale"></i> Calories per serving: {{ recipe.calories }}</strong>
                </p>
                <hr>
        </div>

        <div class="ingredients-container col-12 col-lg-6 mt-3 align-self-center">
            <h2 class="fontM" id="ingredients">Ingredients:</h2>
            {{ recipe.ingredients | safe }} 
        </div>

        <div class="instructions-container col-12 col-lg-6 mt-3">
            <h2  class="fontM" id="instructions">Instructions:</h2>
            {{ recipe.instructions | safe }} 
            <hr>
        </div>
    </div>
    
  </div>
  <div class="container comment-bg">
    <div class="row">
        <div class="col-md-8 mb-4 mt-3 align-self-start ">
            <h2 class="fontM comments">Comments:</h3>
            <div class="card-body">
                <!-- We want a for loop inside the empty control tags to iterate through each comment in comments -->
                {% for comment in comments %}
                <div class="comments{% if not comment.approved and comment.name == user.username %} faded{% elif not comment.approved %} d-none{% endif %}"
                    style="padding: 10px;">
                    <p class="font-weight-bold">
                        <!-- The commenter's name goes here. Check the model if you're not sure what that is -->
                        {{ comment.name }}
                        <span class="font-weight-normal">
                            <!-- The comment's created date goes here -->
                            {{ comment.created_on }}
                        </span> wrote:
                    </p>
                    <!-- The body of the comment goes before the | -->
                    <div id="comment{{ comment.id }}">
                        {{ comment.comment | linebreaks }}
                    </div>
                    {% if not comment.approved and comment.name == user.username %}
                    <p class="approval">This comment is awaiting approval</p>{% endif %}
                    {% if user.is_authenticated and comment.name == user.username %}
                    <button class="btn btn-delete" comment_id="{{ comment.id }}">Delete</button>
                    <button class="btn btn-edit" comment_id="{{ comment.id }}">Edit</button>
                    {% endif %}
                </div>
                <!-- Our for loop ends here -->
                {% endfor %}
            </div>
        </div>
        <div class="col-md-4 card mb-4  mt-3 ">
            <div class="card-body">
                <!-- For later -->
                {% if user.is_authenticated %}

                <h2 class="fontM comments">Leave a comment:</h3>
                <p class="fontH">Posting as: {{ user }}</p>
                <form id="commentForm" method="post" style="margin-top: 1.3em;">
                    {{ comment_form | crispy }}
                    {% csrf_token %}
                    <button id="submitButton" type="submit" class="btn btn-signup btn-lg">Submit</button>
                </form>
                {% else %}
                <h3 class="fontH">Log in to leave a comment</h3>
                {% endif %}
            </div>
        </div>
    </div>
    <p class="fontH">
        <strong> This recipe was published on: {{ recipe.created_on }} </strong>
    </p>
</div>

</div>

{% endblock %}
